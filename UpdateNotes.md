# 开发记录

## 数据清理（Data Clean）
- 输入数据保留
  - 材质，厚度，坡口角度，钝边，间隙，直径
  - 是否抽丝因全部数据集都为“是”，因此不纳入训练
  - Excel数据中，厚度为“6对4”，“6对接4”文本转换为6.4
  - 非增透剂打底sheet中包含三组两端-中间焊接数据，因区别于其他数据，暂时清除
  - 多程序段合并为一段，焊接角度将相加，其余参数依照各自焊接角度占比百分比参与均值计算
  - Question: Mismatch in record: {'材质': '碳钢', '厚度': 4.0, '坡口角度': 0.0, '钝边': 0.0, '间隙': 0.0, '直径': 89, '增透剂': '是'} 
  - Question2: Mismatch in record: {'材质': '碳钢', '厚度': 5.0, '坡口角度': 0.0, '钝边': 0.0, '间隙': 0.0, '直径': 89, '增透剂': '是'} 

- 模型采用Sklearn决策树模型
  - Update (2025.04.04):
  def _build_feature_vector(self, record):
    在 `_build_feature_vector` 中添加
    ```python
      # 原始特征
      features = [
          record['厚度'],
          record['坡口角度'],
          record['钝边'],
          record['间隙'],
          record['直径'],
          1 if record['增透剂'] == '是' else 0,
          self.material_encoder[record['材质']]
      ]
      
      # 添加派生特征
      features.extend([
          record['厚度'] * record['坡口角度'],  # 相互作用特征
          record['直径'] / 100.0,  # 归一化直径
          np.log1p(record['直径']),  # 对数变换
          record['厚度'] ** 2,  # 二次项
          record['钝边'] / (record['厚度'] + 0.001)  # 钝边比例
      ])
      
      return features
    ```
    为什么这些特征工程方法能提高模型准确度
    这些特征扩展方法能提高模型准确度的原因主要有以下几点：
    1. 捕捉非线性关系
    ```python
      record['厚度'] ** 2,  # 二次项
      np.log1p(record['直径']),  # 对数变换
    ```
    对数变换
    二次项特征：当原始特征与目标变量之间存在二次函数形式的关系时，添加平方项可以直接模拟这种非线性关系。比如，厚度增加可能初期对焊接参数有较小影响，但当厚度超过某个阈值后，影响可能急剧增大。
    对数变换：对直径进行对数变换可以处理偏斜分布，使得大范围数值（如从20mm到480mm的直径差异）被压缩到更合理的尺度。对数变换特别适合处理指数或幂律关系。
    2. 特征交互作用
    ```python
      record['厚度'] * record['坡口角度'],  # 相互作用特征
    ```
    相互作用特征
    厚度和坡口角度的乘积创建了一个新特征，可以捕捉这两个变量之间的交互效应。在焊接过程中，同样厚度的材料在不同坡口角度下可能需要完全不同的焊接参数，这种交互作用通过简单的线性模型难以表达。
    3. 特征归一化与比例关系
    ```python
      record['直径'] / 100.0,  # 归一化直径
      record['钝边'] / (record['厚度'] + 0.001)  # 钝边比例
    ```
    钝边比例
    归一化直径：将直径除以100使其数值范围更接近其他特征，这可以改善基于距离的模型或需要数值平衡的算法的表现。
    钝边比例：创建钝边与厚度的比值特征，表达了一个重要的相对关系。在焊接中，钝边相对于总厚度的比例往往比绝对钝边值更能影响焊接工艺参数的选择。